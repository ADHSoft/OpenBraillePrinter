/*
 * Open Braille Printer (C) 2017-2019 Alejandro Herme.
 * See LICENSE.txt for more details. Contact : alejandrodherme@gmail.com
*/

/*******************************************************************************************************************************//**
 *
 * @file		Template.c
 * @brief		Breve descripción del objetivo del Módulo
 * @date		Fecha de creacion del archivo XX/XX/XXXX
 * @author		Nombre, Apellido
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "PR_debounce.h"
#include "DR_Infotronic.h"
#include "DR_tipos.h"
#include "DR_gpio.h"
#include "DR_motores.h"
/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/
#define CANT_ENTRADAS  5
#define ACEPTAR_ESTADO 8
/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
__RW uint8_t BufferEntradas=0;
/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/
 __RW static uint8_t Contador_Estados[CANT_ENTRADAS];
/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/
 
 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
 \fn   void Debounce (void)
 \brief funcion principal
 \param void
 \return void
 */

void Debounce(void)

{
	uint8_t i,lectura=0,cambios;
	if (GetPIN ( SENSOR_PAPEL,ALTO)) lectura|=0x01;
	if (GetPIN ( SENSOR_FIN_CARRO,BAJO)) lectura|=0x02;
	if (GetPIN ( SW1,BAJO)) lectura|=0x04;
	if (GetPIN ( SW2,BAJO)) lectura|=0x08;
	if (GetPIN ( SW3,BAJO)) lectura|=0x10;

	cambios= BufferEntradas ^ lectura;
	if (cambios)
	   {
		 for(i=0;i< CANT_ENTRADAS;i++)
		    {
			  if (cambios & (0x01 << i))
			    {
				  Contador_Estados[i]++;
			      if (Contador_Estados[i]== ACEPTAR_ESTADO)
			         {
			    	   BufferEntradas= BufferEntradas ^ (0x01 << i);
			    	   Contador_Estados[i]=0;
			         }
			      }
			  else
				  Contador_Estados[i]=0;

		     }
	   }

	else
		for(i=0;i< CANT_ENTRADAS;i++)
		   {
			Contador_Estados[i]=0;
		   }

	}





